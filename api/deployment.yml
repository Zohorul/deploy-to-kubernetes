apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: api
  annotations:
    description: AntiNex API - Django REST Framework with JWT and Swagger - Celery Producer
    runtime: python3
  labels:
    antinex: api
    purpose: rest
    layer: rest
    auth: jwt
    toolchain: swagger
    messaging: redis
    cache: redis
    pubsub: publisher
spec:
  replicas: 2
  selector:
    matchLabels:
      app: api
  template:
    metadata:
      labels:
        app: api
        purpose: rest
        layer: rest
        auth: jwt
        toolchain: swagger
        messaging: redis
        cache: redis
        pubsub: publisher
    spec:
      hostname: api
      restartPolicy: Always
      containers:
      - image: jayjohnson/antinex-api:latest
        imagePullPolicy: Always
        name: api
        ports:
        - containerPort: 8010
        resources: {}
        command:
        - /bin/bash
        - -c
        - cd /opt/antinex/api &&
          . /opt/venv/bin/activate &&
          source /opt/antinex/api/envs/k8.env &&
          /opt/antinex/api/run-django.sh
        env:
        - name: POSTGRES_USER
          value: antinex
        - name: POSTGRES_PASSWORD
          value: antinex
        - name: POSTGRES_DB
          value: webapp
