apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: core
  annotations:
    description: AntiNex - AI Core - Celery Worker for Training and Making Predictions
    runtime: python3
  labels:
    app: core
    purpose: worker
    layer: backend
    ai.framework: keras
    ai.backend: tensorflow
    layer: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: core
  template:
    metadata:
      labels:
        app: core
        purpose: worker
        layer: backend
        ai.framework: keras
        ai.backend: tensorflow
        layer: backend
    spec:
      hostname: core
      restartPolicy: Always
      containers:
      - image: jayjohnson/antinex-core:latest
        imagePullPolicy: Always
        name: core
        resources: {}
        command:
        - /bin/bash
        - -c
        - cd /opt/antinex/core &&
          . /opt/venv/bin/activate &&
          source /opt/antinex/api/envs/k8.env &&
          /opt/antinex/core/run-antinex-core.sh
        env:
        - name: POSTGRES_USER
          value: antinex
        - name: POSTGRES_PASSWORD
          value: antinex
        - name: POSTGRES_DB
          value: webapp
